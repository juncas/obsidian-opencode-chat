# å¼€å‘å†ç¨‹ (Memory)

> [! IMPORTANT] AI Agent å¿…è¯»æ–‡æ¡£
> **è¿™æ˜¯ AI Agent æ¥æ‰‹å¼€å‘ä»»åŠ¡å‰å¿…é¡»é˜…è¯»çš„ä¸‰ä»½æ–‡æ¡£ä¹‹ä¸€ï¼š**
>
> 1. **MEMORY.md (æœ¬æ–‡æ¡£)** - äº†è§£å¼€å‘å†å²å’Œå…³é”®å†³ç­–
> 2. [FEATURES.md](./FEATURES.md) - äº†è§£åŠŸèƒ½çŠ¶æ€å’Œå¾…åŠäº‹é¡¹
> 3. [AGENTS.md](./AGENTS.md) - AI Agent ä»»åŠ¡æ‰§è¡ŒæŒ‡å—
>
> **é˜…è¯»å®Œè¿™ä¸‰ä»½æ–‡æ¡£åï¼Œå†å¼€å§‹æ‰§è¡Œä»»åŠ¡ã€‚**

è®°å½• OpenCode Chat for Obsidian é¡¹ç›®çš„å®Œæ•´å¼€å‘å†ç¨‹ã€å…³é”®å†³ç­–å’Œç»éªŒæ•™è®­ã€‚

---

## ğŸ“– æœ¬æ–‡æ¡£é˜…è¯»æŒ‡å—

**ä½œä¸º AI Agentï¼Œé˜…è¯»æœ¬æ–‡æ¡£æ—¶è¯·é‡ç‚¹å…³æ³¨ï¼š**

| ç« èŠ‚ | å…³æ³¨ç‚¹ | é¿å…çš„é—®é¢˜ |
|------|--------|-----------|
| é¡¹ç›®æ—¶é—´çº¿ | å„ Sprint å®Œæˆçš„åŠŸèƒ½ | é‡å¤å¼€å‘å·²æœ‰åŠŸèƒ½ |
| å…³é”®å†³ç­–è®°å½• | ä¸ºä»€ä¹ˆé€‰æ‹©æŸäº›æŠ€æœ¯æ–¹æ¡ˆ | æ¨ç¿»å·²å†³å®šçš„æ–¹æ¡ˆ |
| æŠ€æœ¯å€ºåŠ¡ | éœ€è¦ä¼˜åŒ–çš„åœ°æ–¹ | å¼•å…¥å·²çŸ¥é—®é¢˜ |
| é‡åˆ°çš„é—®é¢˜ | å†å²é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ | é‡è¹ˆè¦†è¾™ |


---

## é¡¹ç›®æ—¶é—´çº¿

```
2026-02-08  é¡¹ç›®å¯åŠ¨ï¼ŒåŸºç¡€æ¶æ„æ­å»º
2026-02-10  Sprint 1 å®Œæˆ - åŸºç¡€èŠå¤©åŠŸèƒ½
2026-02-13  Sprint 2 å®Œæˆ - å†™ä½œå·¥ä½œæµ
2026-02-15  Sprint 3 å®Œæˆ - çŸ¥è¯†åº“å®¡è®¡
2026-02-17  Sprint 4 å®Œæˆ - å¾®ä¿¡å¯¼å‡º
2026-02-19  Sprint 5 å®Œæˆ - æ–‡æ¡£æ•´ç†
2026-02-19  Sprint 6 å®Œæˆ - æ–‡æ¡£è§„åˆ’ä¸è¡¥å……
```

---

## 2026-02-19 - Sprint 6: æ–‡æ¡£è§„åˆ’ä¸è¡¥å……

### ç›®æ ‡
è¡¥å……å¼€æºé¡¹ç›®æ ‡å‡†æ–‡æ¡£ï¼Œå®Œå–„ç”¨æˆ·æŒ‡å—

### é‡‡ç”¨æ–¹æ¡ˆ
æ–¹æ¡ˆ A - æ¸è¿›è¡¥å……ï¼šåœ¨ç°æœ‰æ¡†æ¶ä¸‹è¡¥å……æœ€å…³é”®çš„ç¼ºå¤±æ–‡æ¡£

### å®Œæˆå†…å®¹

**æ–°å¢æ–‡æ¡£**:
- `CHANGELOG.md` - ç‰ˆæœ¬å˜æ›´æ—¥å¿—ï¼ˆéµå¾ª Keep a Changelog æ ¼å¼ï¼‰
- `CONTRIBUTING.md` - è´¡çŒ®æŒ‡å—ï¼ˆåŒ…å«æ–‡æ¡£æ›´æ–°è¦æ±‚ï¼‰
- `docs/user-guide.md` - è¯¦ç»†ç”¨æˆ·æŒ‡å—ï¼ˆå›¾æ–‡å¹¶èŒ‚ï¼‰

**æ›´æ–°çš„æ–‡æ¡£**:
- `README.md` - æ·»åŠ æ–°æ–‡æ¡£é“¾æ¥
- `AGENTS.md` - æ›´æ–°æ–‡æ¡£å¯¼èˆªè¡¨

### æŠ€æœ¯å†³ç­–

**CHANGELOG æ ¼å¼**: é‡‡ç”¨ Keep a Changelog æ ‡å‡†æ ¼å¼
- ä» v1.0.0 å¼€å§‹è®°å½•ï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰
- åˆ†ç±»ï¼šAdded, Changed, Fixed
- åŒ…å« Sprint æ˜ å°„è¡¨

**ç”¨æˆ·æŒ‡å—è¯¦ç»†ç¨‹åº¦**: è¯¦ç»†ç‰ˆï¼Œå›¾æ–‡å¹¶èŒ‚
- ä½¿ç”¨ ASCII å›¾è¡¨å±•ç¤º UI
- åŒ…å« Mermaid æµç¨‹å›¾
- è¦†ç›–æ‰€æœ‰åŠŸèƒ½å’ŒæŠ€å·§

**è´¡çŒ®æŒ‡å—èŒƒå›´**: åŒ…å«æ–‡æ¡£æ›´æ–°è¦æ±‚
- åŒ…å«å®Œæ•´çš„ä»£ç å®¡æŸ¥æ ‡å‡†

### ç»éªŒæ•™è®­

1. **æ–‡æ¡£åˆ†å±‚é‡è¦**: å…¥å£æ–‡æ¡£ï¼ˆREADMEï¼‰â†’ å¯¼èˆªæ–‡æ¡£ï¼ˆAGENTSï¼‰â†’ è¯¦ç»†æ–‡æ¡£
2. **å›¾æ–‡å¹¶èŒ‚**: ç”¨æˆ·æŒ‡å—ä¸­ä½¿ç”¨ ASCII å›¾å’Œä»£ç ç¤ºä¾‹å¢å¼ºå¯è¯»æ€§
3. **æ ‡å‡†æ ¼å¼ä»·å€¼**: é‡‡ç”¨ Keep a Changelog ç­‰æ ‡å‡†æ ¼å¼é™ä½ç†è§£æˆæœ¬

---

## 2026-02-19 - Sprint 5: æ–‡æ¡£æ•´ç†

### ç›®æ ‡
ä¸ºå¼€å‘è€…å’Œ AI Agent åˆ›å»ºå…¨é¢çš„æ–‡æ¡£ä½“ç³»

### å®Œæˆå†…å®¹

**æ ¸å¿ƒæ–‡æ¡£**:
- `FEATURES.md` - åŠŸèƒ½è¿­ä»£è®°å½•
- `AGENTS.md` - AI Agent å¼€å‘æŒ‡å—
- `MEMORY.md` - å¼€å‘å†ç¨‹ï¼ˆæœ¬æ–‡æ¡£ï¼‰

**docs/ ç›®å½•æ–‡æ¡£**:
- `architecture.md` - ç³»ç»Ÿæ¶æ„è®¾è®¡
- `api-reference.md` - API å‚è€ƒ
- `development-setup.md` - å¼€å‘ç¯å¢ƒè®¾ç½®
- `coding-standards.md` - ç¼–ç è§„èŒƒ
- `troubleshooting.md` - æ•…éšœæ’æŸ¥
- `skills-system.md` - æŠ€èƒ½ç³»ç»Ÿ

### å…³é”®å†³ç­–

**æ–‡æ¡£ç»“æ„é€‰æ‹©**:
- é‡‡ç”¨æ¨¡å—åŒ–æ–‡æ¡£è€Œéå•ä¸€é•¿æ–‡æ¡£
- ä¸º AI Agent åˆ›å»ºä¸“é—¨çš„ `AGENTS.md`
- ç”¨ `FEATURES.md` è¿½è¸ªåŠŸèƒ½è¿­ä»£
- ç”¨ `MEMORY.md` è®°å½•å†³ç­–å†å²

### ç»éªŒæ•™è®­

1. **æ–‡æ¡£åŠæ—¶æ›´æ–°**: åŠŸèƒ½å¼€å‘åŒæ—¶æ›´æ–°æ–‡æ¡£ï¼Œé¿å…äº‹åè¡¥å……
2. **AI å‹å¥½æ ¼å¼**: ä½¿ç”¨æ¸…æ™°çš„ Markdown ç»“æ„ï¼Œä¾¿äº AI ç†è§£
3. **ä»£ç å³æ–‡æ¡£**: ç±»å‹å®šä¹‰æ¸…æ™°ï¼Œå‡å°‘è§£é‡Šæ€§æ–‡æ¡£

---

## 2026-02-17 ~ 2026-02-19 - Sprint 4: å¾®ä¿¡å¯¼å‡ºä¸å‘å¸ƒåŠ©æ‰‹

### ç›®æ ‡
æ”¯æŒå¾®ä¿¡å…¬ä¼—å·æ–‡ç« æ ¼å¼å¯¼å‡ºå’Œå‘å¸ƒè¾…åŠ©åŠŸèƒ½

### å®Œæˆå†…å®¹

**WeChat å¯¼å‡ºåŠŸèƒ½**:
- `WeChatExporter.ts` - HTML ç”Ÿæˆé€»è¾‘
- `WeChatStyles.ts` - 5 ç§æ ·å¼æ¨¡æ¿
- `WeChatStyleModal.ts` - æ ·å¼é€‰æ‹©å¯¹è¯æ¡†
- `WeChatPreviewView.ts` - é¢„è§ˆè§†å›¾

**å‘å¸ƒåŠ©æ‰‹**:
- `PublishAssistantService.ts` - ä»“åº“å…ƒæ•°æ®æ”¶é›†
- æ ‡ç­¾ä½“ç³»åˆ†æï¼ˆé¢‘ç‡ç»Ÿè®¡ï¼‰
- æ–‡ä»¶å¤¹ç»“æ„æ‰«æï¼ˆå‰ä¸¤å±‚ï¼‰
- YAML frontmatter è‡ªåŠ¨ç”Ÿæˆ

### æŠ€æœ¯å®ç°

**å¾®ä¿¡æ ·å¼æ¨¡æ¿**:
```typescript
// 5 ç§é¢„è®¾æ ·å¼
const WECHAT_STYLES = [
    'ç®€æ´é£æ ¼',
    'æŠ€æœ¯æ–‡ç« ',
    'æ–‡è‰ºé£æ ¼',
    'å•†åŠ¡é£æ ¼',
    'æ´»æ³¼é£æ ¼'
];
```

**å‘å¸ƒä¸Šä¸‹æ–‡æ„å»º**:
```typescript
buildPublishContext() {
    return {
        folderStructure: scanFolders(2),  // å‰ä¸¤å±‚
        tagTaxonomy: analyzeTags(50),      // Top 50 æ ‡ç­¾
        recentPaths: getRecentNotes(10)    // æœ€è¿‘ 10 ç¯‡
    };
}
```

### é‡åˆ°çš„é—®é¢˜

**é—®é¢˜**: å¾®ä¿¡æ–‡ç« å›¾ç‰‡è·¯å¾„å¤„ç†
- **ç°è±¡**: ç›¸å¯¹è·¯å¾„å›¾ç‰‡æ— æ³•æ˜¾ç¤º
- **åŸå› **: å¾®ä¿¡ç¼–è¾‘å™¨ä½¿ç”¨ç»å¯¹è·¯å¾„
- **è§£å†³**: å¯¼å‡ºæ—¶ä½¿ç”¨ç»å¯¹è·¯å¾„æˆ– base64 åµŒå…¥

**é—®é¢˜**: æ ‡ç­¾å»é‡é€»è¾‘
- **ç°è±¡**: åŒä¸€æ ‡ç­¾ä¸åŒæ ¼å¼ï¼ˆå¦‚ `#tag` å’Œ `tag`ï¼‰
- **è§£å†³**: ç»Ÿä¸€å»é™¤ `#` å‰ç¼€åæ¯”è¾ƒ

### ç»éªŒæ•™è®­

1. **æ ·å¼éš”ç¦»**: å¾®ä¿¡æ ·å¼ç‹¬ç«‹æ–‡ä»¶ï¼Œé¿å…æ±¡æŸ“ä¸»æ ·å¼
2. **å¯¼å‡ºé…ç½®åŒ–**: æ ·å¼å¯é€‰ï¼Œä¾¿äºæ‰©å±•
3. **å…ƒæ•°æ®ç¼“å­˜**: ä»“åº“å…ƒæ•°æ®è®¡ç®—æˆæœ¬é«˜ï¼Œè€ƒè™‘ç¼“å­˜

---

## 2026-02-15 - Sprint 3: çŸ¥è¯†åº“å®¡è®¡ä¸å¼•ç”¨è´¨é‡

### ç›®æ ‡
å®ç°çŸ¥è¯†åº“å¥åº·æ£€æŸ¥å’Œå¼•ç”¨è´¨é‡è¯„ä¼°

### å®Œæˆå†…å®¹

**KB å¥åº·å®¡è®¡**:
- `KnowledgeBaseService.ts` - å®¡è®¡æœåŠ¡
- æ–­é“¾æ£€æµ‹ï¼ˆ`[[unresolved]]`ï¼‰
- å­¤å„¿ç¬”è®°æ£€æµ‹ï¼ˆæ— å…¥é“¾ï¼‰
- é™ˆæ—§ç¬”è®°æ£€æµ‹ï¼ˆä¿®æ”¹æ—¶é—´ï¼‰

**å¼•ç”¨è´¨é‡è¯„ä¼°**:
- `CitationQualityService.ts` - å¼•ç”¨è¯„ä¼°
- è®ºæ–­æ£€æµ‹ï¼ˆæ­£åˆ™åŒ¹é…ï¼‰
- è¦†ç›–ç‡è®¡ç®—
- æœªå¼•ç”¨è®ºæ–­åˆ—è¡¨

**æŠ€èƒ½æ–‡ä»¶**:
- `evidence-qa/SKILL.md` - è¯æ® QA æŠ€èƒ½
- `kb-health-audit/SKILL.md` - KB å®¡è®¡æŠ€èƒ½

### æŠ€æœ¯å®ç°

**å¼•ç”¨è¦†ç›–ç‡ç®—æ³•**:
```typescript
evaluate(content: string): CitationCoverageReport {
    const claims = extractClaims(content);  // æå–è®ºæ–­
    const cited = claims.filter(c => hasCitation(c));
    return {
        coverage: cited.length / claims.length,
        totalClaims: claims.length,
        citedClaims: cited.length,
        uncitedClaims: claims.filter(c => !hasCitation(c))
    };
}
```

**å®¡è®¡æµç¨‹**:
```typescript
async runAudit(): Promise<AuditReport> {
    const files = this.app.vault.getMarkdownFiles();
    const report = {
        brokenLinks: await this.checkBrokenLinks(files),
        orphans: await this.checkOrphans(files),
        stale: await this.checkStale(files),
        duplicates: await this.checkDuplicates(files)
    };
    return report;
}
```

### é‡åˆ°çš„é—®é¢˜

**é—®é¢˜**: è®ºæ–­æ£€æµ‹å‡†ç¡®ç‡ä½
- **ç°è±¡**: è¿‡å¤šè¯¯æŠ¥ï¼ˆéè®ºæ–­å¥å­è¢«æ ‡è®°ï¼‰
- **åŸå› **: ç®€å•æ­£åˆ™æ— æ³•åŒºåˆ†è®ºæ–­å’Œæè¿°
- **è§£å†³**: æ·»åŠ ç½®ä¿¡åº¦è¯„åˆ†ï¼Œä½ç½®ä¿¡åº¦ä¸æ˜¾ç¤º

**é—®é¢˜**: å­¤å„¿ç¬”è®°è¯¯æŠ¥
- **ç°è±¡**: éƒ¨åˆ†ç¬”è®°è¢«æ ‡è®°ä¸ºå­¤å„¿ä½†å®é™…æœ‰é“¾æ¥
- **åŸå› **: æœªè§£æ `[[wiki-link]]` æ ¼å¼
- **è§£å†³**: ä½¿ç”¨ Obsidian API è§£æé“¾æ¥

### ç»éªŒæ•™è®­

1. **è‡ªåŠ¨åŒ–ä¼˜å…ˆ**: ä½¿ç”¨ Obsidian å…ƒæ•°æ®ç¼“å­˜åŠ é€Ÿæ‰«æ
2. **æ¸è¿›å¼æŠ¥å‘Š**: å…ˆå¿«é€Ÿæ‰«æï¼Œå†è¯¦ç»†åˆ†æ
3. **å¯æ“ä½œè¾“å‡º**: æŠ¥å‘ŠåŒ…å«ä¼˜å…ˆçº§å’Œå…·ä½“è¡ŒåŠ¨å»ºè®®

---

## 2026-02-13 - Sprint 2: å†™ä½œå·¥ä½œæµ

### ç›®æ ‡
å®ç°å…­é˜¶æ®µç»“æ„åŒ–å†™ä½œæµç¨‹

### å®Œæˆå†…å®¹

**æ ¸å¿ƒæœåŠ¡**:
- `WritingWorkflowService.ts` - å·¥ä½œæµé€»è¾‘
- `ContextResolver.ts` - ä¸Šä¸‹æ–‡æ†ç»‘

**UI ç»„ä»¶**:
- `WritingTaskPanel.ts` - ä»»åŠ¡é¢æ¿
- é˜¶æ®µå¯¼èˆªæŒ‰é’®
- å…ƒæ•°æ®ç¼–è¾‘ï¼ˆå—ä¼—ã€è¯­æ°”ã€é•¿åº¦ï¼‰
- è‰ç¨¿ç‰ˆæœ¬åˆ—è¡¨

**ç±»å‹å®šä¹‰**:
- `WritingStage` - å…­é˜¶æ®µç±»å‹
- `WritingTask` - ä»»åŠ¡çŠ¶æ€
- `DraftVersion` - è‰ç¨¿å¿«ç…§

### æŠ€æœ¯å®ç°

**é˜¶æ®µçŠ¶æ€æœº**:
```typescript
const STAGE_SEQUENCE: WritingStage[] = [
    'discover', 'outline', 'draft',
    'evidence', 'polish', 'publish'
];

// é˜¶æ®µæ¨è¿›
updateStage(sessionKey: string, stage: WritingStage) {
    task.stageHistory.push({
        from: previousStage,
        to: stage,
        timestamp: new Date()
    });
    task.stage = stage;
}
```

**è‰ç¨¿ç‰ˆæœ¬æ•è·**:
```typescript
addDraftVersion(stage: WritingStage, content: string) {
    // ä»…åœ¨å†…å®¹å˜åŒ–æ—¶åˆ›å»ºæ–°ç‰ˆæœ¬
    if (currentVersion.content === content) return;

    const version: DraftVersion = {
        id: generateId(),
        stage,
        label: `${stage} v${index}`,
        content,
        createdAt: new Date(),
        citationCoverage: metrics?.coverage
    };
    task.draftVersions.push(version);
}
```

**ä¸Šä¸‹æ–‡æ†ç»‘**:
```typescript
resolveSnapshot(input: string): WritingContextSnapshot {
    return {
        activeFile: getCurrentFile(),
        selection: getSelection(),
        mentions: parseMentions(input),
        recent: getRecentFiles(5),
        related: searchRelated(input)
    };
}
```

### é‡åˆ°çš„é—®é¢˜

**é—®é¢˜**: é˜¶æ®µè·³è½¬é€»è¾‘å¤æ‚
- **ç°è±¡**: ç”¨æˆ·å¯è·³è¿‡é˜¶æ®µï¼Œå¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´
- **åŸå› **: ç¼ºå°‘é˜¶æ®µå‰ç½®æ¡ä»¶æ£€æŸ¥
- **è§£å†³**: å…è®¸ä»»æ„è·³è½¬ï¼Œä½†è®°å½•å®Œæ•´å†å²

**é—®é¢˜**: è‰ç¨¿ç‰ˆæœ¬é‡å¤æ•è·
- **ç°è±¡**: ç›¸åŒå†…å®¹åˆ›å»ºå¤šä¸ªç‰ˆæœ¬
- **åŸå› **: æœªæ¯”è¾ƒå†…å®¹å·®å¼‚
- **è§£å†³**: æ·»åŠ å†…å®¹å¯¹æ¯”ï¼Œç›¸åŒåˆ™è·³è¿‡

### ç»éªŒæ•™è®­

1. **é˜¶æ®µæç¤º**: ä½¿ç”¨ `<stage_completed>` æ ‡ç­¾è®© AI çŸ¥é“é˜¶æ®µå®Œæˆ
2. **ç‰ˆæœ¬å¯è§†åŒ–**: æ˜¾ç¤ºé˜¶æ®µå†å²æ—¶é—´çº¿ï¼Œä¾¿äºè¿½æº¯
3. **å¼•ç”¨æŒ‡æ ‡**: å®æ—¶æ˜¾ç¤ºå¼•ç”¨è¦†ç›–ç‡ï¼Œæé†’è¡¥å……è¯æ®

---

## 2026-02-10 - Sprint 1: åŸºç¡€èŠå¤©åŠŸèƒ½

### ç›®æ ‡
å»ºç«‹åŸºç¡€èŠå¤©ç•Œé¢å’Œ OpenCode é›†æˆ

### å®Œæˆå†…å®¹

**æ ¸å¿ƒæ¶æ„**:
- `OpenCodeServer.ts` - HTTP æœåŠ¡æ¡¥æ¥
- `SessionManager.ts` - ä¼šè¯ç®¡ç†
- `OpenCodeChatView.ts` - ä¸»è§†å›¾

**åŸºç¡€ UI**:
- `ChatInput.ts` - è¾“å…¥æ¡†
- `MessageContainer.ts` - æ¶ˆæ¯åˆ—è¡¨
- `SessionTabs.ts` - ä¼šè¯æ ‡ç­¾

**OpenCode é›†æˆ**:
- `opencode serve` è¿›ç¨‹ç®¡ç†
- SSE äº‹ä»¶æµè¿æ¥
- HTTP API è°ƒç”¨

### æŠ€æœ¯å®ç°

**OpenCode Server å¯åŠ¨**:
```typescript
async start(): Promise<void> {
    // ç«¯å£æ•…éšœè½¬ç§» (14000-14004)
    for (let attempt = 0; attempt < 5; attempt++) {
        const port = 14000 + attempt;
        try {
            await this.startServerOnPort(port);
            return;
        } catch (error) {
            // å°è¯•ä¸‹ä¸€ä¸ªç«¯å£
        }
    }
}
```

**SSE äº‹ä»¶å¤„ç†**:
```typescript
handleSseData(chunk: string) {
    const events = chunk.split(/\r?\n\r?\n/);
    for (const rawEvent of events) {
        const payload = parseEventData(rawEvent);
        this.handleEvent(payload);
    }
}

handleEvent(event: OpenCodeEvent) {
    switch (event.type) {
        case 'text.delta':
            this.emit('text.delta', ...);
            break;
        case 'session.idle':
            this.emit('session.idle', ...);
            break;
        // ...
    }
}
```

### é‡åˆ°çš„é—®é¢˜

**é—®é¢˜ 1**: OpenCode CLI è·¯å¾„
- **ç°è±¡**: æ‰¾ä¸åˆ° `opencode` å‘½ä»¤
- **åŸå› **: `~/.opencode/bin` ä¸åœ¨ PATH ä¸­
- **è§£å†³**: æ„å»ºå¢å¼º PATHï¼š`buildAugmentedPath()`

**é—®é¢˜ 2**: SSE è¿æ¥ä¸ç¨³å®š
- **ç°è±¡**: å¶å°”æ–­å¼€
- **åŸå› **: ç½‘ç»œæ³¢åŠ¨æˆ–æœåŠ¡å™¨é‡å¯
- **è§£å†³**: å®ç°è‡ªåŠ¨é‡è¿é€»è¾‘ï¼ˆæœ€å¤š 5 æ¬¡ï¼Œ2 ç§’é—´éš”ï¼‰

**é—®é¢˜ 3**: ç«¯å£å ç”¨
- **ç°è±¡**: `EADDRINUSE` é”™è¯¯
- **åŸå› **: ä¸Šæ¬¡è¿›ç¨‹æœªæ­£å¸¸é€€å‡º
- **è§£å†³**: ç«¯å£æ•…éšœè½¬ç§» + é‡å¯å‰ç­‰å¾… 3 ç§’

### ç»éªŒæ•™è®­

1. **å•ä¾‹æ¨¡å¼**: `OpenCodeServer.getInstance()` ç¡®ä¿å…¨å±€å”¯ä¸€å®ä¾‹
2. **ç±»å‹å®‰å…¨**: å®šä¹‰ `TypedEventEmitter` ç¡®ä¿äº‹ä»¶ç±»å‹å®‰å…¨
3. **ä¼˜é›…é™çº§**: ç«¯å£å†²çªæ—¶è‡ªåŠ¨å°è¯•ä¸‹ä¸€ä¸ªç«¯å£

---

## 2026-02-08 - é¡¹ç›®å¯åŠ¨

### èƒŒæ™¯
éœ€è¦åœ¨ Obsidian å†…é›†æˆ OpenCodeï¼Œæä¾›åŸç”Ÿçš„èŠå¤©ä½“éªŒï¼Œè€Œéç»ˆç«¯ CLIã€‚

### æŠ€æœ¯é€‰å‹

**OpenCode é›†æˆæ¨¡å¼**:
- âŒ æ–¹æ¡ˆ A: ä¸€æ¬¡æ€§ CLI è°ƒç”¨ (`opencode run`)
  - ç¼ºç‚¹ï¼šæ— æµå¼è¾“å‡ºã€æ— å·¥å…·å¯è§æ€§
- âœ… æ–¹æ¡ˆ B: HTTP Server æ¨¡å¼ (`opencode serve`)
  - ä¼˜ç‚¹ï¼šSSE æµå¼ã€å·¥å…·è°ƒç”¨å¯è§ã€æƒé™äº¤äº’

**UI æ¡†æ¶**:
- âœ… ä½¿ç”¨ Obsidian åŸç”Ÿ API
  - `ItemView` ä½œä¸ºä¸»è§†å›¾
  - åŸç”Ÿç»„ä»¶ä¿è¯ä¸»é¢˜å…¼å®¹

**çŠ¶æ€ç®¡ç†**:
- âœ… è‡ªç ” `SessionManager`
  - è½»é‡ã€æ— ä¾èµ–
  - æ”¯æŒå¤šä¼šè¯

### åˆå§‹æ¶æ„

```
OpenCodeChatPlugin (main.ts)
  â”‚
  â”œâ”€â”€ OpenCodeServer (æœåŠ¡)
  â”‚     â”œâ”€â”€ spawn `opencode serve`
  â”‚     â”œâ”€â”€ SSE connection
  â”‚     â””â”€â”€ HTTP API calls
  â”‚
  â”œâ”€â”€ SessionManager (æœåŠ¡)
  â”‚     â”œâ”€â”€ sessions[]
  â”‚     â””â”€â”€ currentSessionId
  â”‚
  â””â”€â”€ OpenCodeChatView (è§†å›¾)
        â”œâ”€â”€ ChatInput
        â”œâ”€â”€ MessageContainer
        â””â”€â”€ SessionTabs
```

### ç¬¬ä¸€å¤©æˆæœ

- [x] é¡¹ç›®è„šæ‰‹æ¶æ­å»º
- [x] TypeScript é…ç½®
- [x] ESLint é…ç½®
- [x] åŸºç¡€ UI ç»„ä»¶
- [x] OpenCode Server è¿æ¥
- [x] é¦–æ¬¡æ¶ˆæ¯å‘é€/æ¥æ”¶

### ç»éªŒæ•™è®­

1. **HTTP æ¨¡å¼ä¼˜å…ˆ**: ä¸€å¼€å§‹å°±é€‰æ‹© Server æ¨¡å¼ï¼Œé¿å…åæœŸé‡æ„
2. **ç±»å‹å…ˆè¡Œ**: å…ˆå®šä¹‰ `opencode.ts` ç±»å‹ï¼Œå¼€å‘æ›´é¡ºç•…
3. **æ—¥å¿—å…ˆè¡Œ**: æ—©æœŸæ·»åŠ å……è¶³æ—¥å¿—ï¼Œè°ƒè¯•æ›´é«˜æ•ˆ

---

## å…³é”®å†³ç­–è®°å½•

### å†³ç­– 1: é€‰æ‹© HTTP Server æ¨¡å¼

**æ—¶é—´**: 2026-02-08
**èƒŒæ™¯**: OpenCode æ”¯æŒ CLI å’Œ Server ä¸¤ç§æ¨¡å¼
**é€‰é¡¹**:
- CLI æ¨¡å¼ï¼šç®€å•ä½†åŠŸèƒ½å—é™
- Server æ¨¡å¼ï¼šå¤æ‚ä½†åŠŸèƒ½å®Œæ•´

**å†³ç­–**: Server æ¨¡å¼
**ç†ç”±**:
- æµå¼è¾“å‡ºå¯¹ç”¨æˆ·ä½“éªŒè‡³å…³é‡è¦
- å·¥å…·è°ƒç”¨å’Œæƒé™äº¤äº’éœ€è¦é•¿è¿æ¥
- ç¬¦åˆ Obsidian é•¿æ—¶é—´è¿è¡Œçš„åœºæ™¯

**åæœ**:
- âœ… åŠŸèƒ½å®Œæ•´ï¼Œä½“éªŒæµç•…
- âš ï¸ éœ€è¦å¤„ç†è¿›ç¨‹ç®¡ç†ã€ç«¯å£å ç”¨ã€SSE é‡è¿

---

### å†³ç­– 2: è‡ªç ” SessionManager

**æ—¶é—´**: 2026-02-08
**èƒŒæ™¯**: éœ€è¦æŒä¹…åŒ–ä¼šè¯çŠ¶æ€
**é€‰é¡¹**:
- ä½¿ç”¨ localStorage
- ä½¿ç”¨æ–‡ä»¶å­˜å‚¨
- ä½¿ç”¨ Obsidian Data API

**å†³ç­–**: Obsidian Data API + å†…å­˜ç®¡ç†
**ç†ç”±**:
- Obsidian æ’ä»¶æ ‡å‡†åšæ³•
- è‡ªåŠ¨æŒä¹…åŒ–åˆ° `data.json`
- ç”Ÿå‘½å‘¨æœŸä¸æ’ä»¶ç»‘å®š

**åæœ**:
- âœ… ä¸ Obsidian ç”Ÿæ€ä¸€è‡´
- âœ… ç”¨æˆ·æ•°æ®è‡ªåŠ¨å¤‡ä»½

---

### å†³ç­– 3: å†™ä½œå·¥ä½œæµå…­é˜¶æ®µ

**æ—¶é—´**: 2026-02-10
**èƒŒæ™¯**: éœ€è¦ç»“æ„åŒ–å†™ä½œæ”¯æŒ
**é€‰é¡¹**:
- ç®€å•å¯¹è¯æ¨¡å¼
- å›ºå®šæ¨¡æ¿æ¨¡å¼
- é˜¶æ®µæ¨è¿›æ¨¡å¼

**å†³ç­–**: é˜¶æ®µæ¨è¿›æ¨¡å¼
**ç†ç”±**:
- ç¬¦åˆå†™ä½œè®¤çŸ¥æµç¨‹
- æ¯é˜¶æ®µæœ‰æ˜ç¡®ç›®æ ‡
- ä¾¿äº AI ç†è§£å½“å‰ä»»åŠ¡

**é˜¶æ®µè®¾è®¡**:
```
è°ƒç ” â†’ å¤§çº² â†’ è‰ç¨¿ â†’ è®ºè¯ â†’ æ¶¦è‰² â†’ å‘å¸ƒ
```

**åæœ**:
- âœ… ç”¨æˆ·æœ‰æ¸…æ™°è¿›åº¦æ„Ÿ
- âœ… AI çŸ¥é“å½“å‰é˜¶æ®µç›®æ ‡
- âš ï¸ éœ€è¦çŠ¶æ€ç®¡ç†å’Œç‰ˆæœ¬è¿½è¸ª

---

## æŠ€æœ¯å€ºåŠ¡

### å½“å‰å€ºåŠ¡

| é¡¹ç›® | äº§ç”Ÿæ—¶é—´ | å½±å“ | ä¼˜å…ˆçº§ |
|------|---------|------|--------|
| æ— å•å…ƒæµ‹è¯• | 2026-02-08 | å›å½’æµ‹è¯•å›°éš¾ | ğŸŸ¡ ä¸­ |
| é”™è¯¯è¾¹ç•Œä¸è¶³ | 2026-02-10 | ç”¨æˆ·çœ‹åˆ°åŸå§‹é”™è¯¯ | ğŸŸ¢ é«˜ |
| æ€§èƒ½ä¼˜åŒ–ç¼ºå¤± | 2026-02-13 | å¤§ vault æ‰«ææ…¢ | ğŸŸ¡ ä¸­ |

### å¿è¿˜è®¡åˆ’

1. **çŸ­æœŸ** (Sprint 6): æ·»åŠ é”™è¯¯è¾¹ç•Œï¼Œå‹å¥½é”™è¯¯æç¤º
2. **ä¸­æœŸ** (Sprint 7): æ€§èƒ½ä¼˜åŒ–ï¼Œç¼“å­˜å®¡è®¡ç»“æœ
3. **é•¿æœŸ** (Sprint 8+): å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒæœåŠ¡

---

## æ•°æ®ä¸æŒ‡æ ‡

### ä»£ç ç»Ÿè®¡ (æˆªè‡³ 2026-02-19)

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| TypeScript æ–‡ä»¶ | ~30 |
| ä»£ç è¡Œæ•° | ~5000 |
| æœåŠ¡å±‚æ–‡ä»¶ | 8 |
| UI ç»„ä»¶æ–‡ä»¶ | 10 |
| ç±»å‹å®šä¹‰æ–‡ä»¶ | 3 |

### åŠŸèƒ½è¦†ç›–

| ç±»åˆ« | åŠŸèƒ½æ•° | å®Œæˆç‡ |
|------|--------|--------|
| èŠå¤©æ ¸å¿ƒ | 5 | 100% |
| å†™ä½œå·¥ä½œæµ | 6 | 100% |
| çŸ¥è¯†åº“å·¥å…· | 3 | 100% |
| å¯¼å‡ºåŠŸèƒ½ | 2 | 100% |

---

## æ„Ÿè°¢ä¸è´¡çŒ®

### æ ¸å¿ƒè´¡çŒ®è€…
- juncas (ä½œè€…)

### ä½¿ç”¨æŠ€æœ¯
- [Obsidian](https://obsidian.md) - çŸ¥è¯†åº“å¹³å°
- [OpenCode](https://opencode.ai) - AI ç¼–ç¨‹åŠ©æ‰‹
- TypeScript - ç¼–ç¨‹è¯­è¨€
- esbuild - æ„å»ºå·¥å…·

---

*æœ€åæ›´æ–°ï¼š2026-02-19*
